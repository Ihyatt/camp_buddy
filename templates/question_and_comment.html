{% extends 'base.html' %}
{% block content %}

{{ask.question}}
<div>
<ul id = "comments">
	{% for comment in comments %}
	<li>
		{{comment.comment}}
		<button class="vote" data-direction="up" data-comment-id="{{comment.comment_id}}" id ="{{comment.comment_id}}"> {{comment.vote}} </button>
	</li>
	{% endfor %}
</ul>

</div>	

<input type = "text" name = "comment" placeholder = "write a comment" id = "write-comment">

<input type="button" value="add comment" id = "add-comment">





<script>
function showResult(resp){

	$("#comments").append("<li>" + $("#write-comment").val() + '<button class ="vote" data-direction = "up" data-comment-id="' + resp.comment_id + '"id="' + resp.comment_id +'"> ' + resp.vote + ' </button></li>');
		
	$("#write-comment").val("");
	$(".vote").click(submitVote);


	
}
function submitComment(evt) {
	var comment = {
		"comment": $("#write-comment").val(),
		"question_id": getQuestionId()
	};

$.post("/add-comment.json", comment, showResult);

}

function getQuestionId() {
	componenets = window.location.href.split("/")
	idx = componenets.length - 1
	return componenets[idx]
}

$("#add-comment").on("click", submitComment);

// *******************************************

function updateVote(results) {
	var updated_vote = results["vote"];
	$("#"+results['comment_id']).text(updated_vote);
	console.log("Vote added")
}


function submitVote(evt) {
	var voted_item = {
		"voted_item": $(evt.target).data("direction"),
		"comment_id": $(evt.target).data("comment-id")
	}
	
	$.get("/add-vote.json", voted_item, updateVote);

}

$(".vote").click(submitVote);

</script>



{% endblock %}